(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const g of o.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&n(g)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function w(i){return Math.floor(Math.random()*i)}function C(){return`rgb(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255})`}const f=document.getElementById("terrain"),a=f.getContext("2d"),r=20,c=f.width/r,T=document.getElementById("score");let h=0,x=300,M=!1,j=!1,v=!1;function m(){return Math.floor(Math.random()*4)}class ${constructor(e,t){this.largeur=e,this.hauteur=t,this.grille=Array.from({length:t},()=>Array(e).fill(0))}ajouterObstacle(e,t){this.estDansLimites(e,t)&&(this.grille[t][e]=1)}estObstacle(e,t){return this.estDansLimites(e,t)&&this.grille[t][e]===1}estDansLimites(e,t){return e>=0&&e<this.largeur&&t>=0&&t<this.hauteur}draw(){for(let e=0;e<this.hauteur;e++)for(let t=0;t<this.largeur;t++)this.grille[e][t]===1&&(a.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--mur-couleur"),a.fillRect(t*r,e*r,r,r),a.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue("--mur-contour"),a.strokeRect(t*r,e*r,r,r))}}class E{constructor(e,t,n){this.i=e,this.j=t,this.couleur=n}draw(){a.fillStyle=this.couleur;const e=this.i*r,t=this.j*r,n=6;a.beginPath(),a.moveTo(e+n,t),a.lineTo(e+r-n,t),a.quadraticCurveTo(e+r,t,e+r,t+n),a.lineTo(e+r,t+r-n),a.quadraticCurveTo(e+r,t+r,e+r-n,t+r),a.lineTo(e+n,t+r),a.quadraticCurveTo(e,t+r,e,t+r-n),a.lineTo(e,t+n),a.quadraticCurveTo(e,t,e+n,t),a.closePath(),a.fill()}move(e){switch(e){case 0:this.j=(this.j-1+c)%c;break;case 1:this.i=(this.i+1)%c;break;case 2:this.j=(this.j+1)%c;break;case 3:this.i=(this.i-1+c)%c;break}}copy(e){this.i=e.i,this.j=e.j}}class d{constructor(e,t,n,s){this.anneaux=[],this.direction=s;for(let o=0;o<e;o++){let g=o===0?"red":o===e-1?"pink":C();this.anneaux.push(new E(t,n,g))}}draw(){for(let e of this.anneaux)e.draw()}move(){let e=this.anneaux[0].i,t=this.anneaux[0].j;switch(this.direction){case 0:t--;break;case 1:e++;break;case 2:t++;break;case 3:e--;break}if(e<0||e>=c||t<0||t>=c||u.estObstacle(e,t))return!1;for(let n=this.anneaux.length-1;n>0;n--)this.anneaux[n].copy(this.anneaux[n-1]);return this.anneaux[0].i=e,this.anneaux[0].j=t,!0}changeDirection(e){Math.abs(this.direction-e)!==2&&(this.direction=e)}extend(){const e=this.anneaux[this.anneaux.length-1],t=C();this.anneaux.push(new E(e.i,e.j,t))}detecteAutoCollision(){let e=this.anneaux[0];for(let t=1;t<this.anneaux.length;t++)if(e.i===this.anneaux[t].i&&e.j===this.anneaux[t].j)return!0;return!1}}class D{constructor(e){this.terrain=e,this.placerFruit()}placerFruit(){let e,t;do e=w(this.terrain.largeur),t=w(this.terrain.hauteur);while(this.terrain.estObstacle(e,t));this.i=e,this.j=t}draw(){a.fillStyle="green",a.beginPath(),a.arc(this.i*r+r/2,this.j*r+r/2,r/2.5,0,2*Math.PI),a.fill()}estMangePar(e){let t=e.anneaux[0];return t.i===this.i&&t.j===this.j}}let l=new d(5,10,10,1),y=new d(3,5,5,m()),p=new d(4,8,8,m());function q(){a.clearRect(0,0,f.width,f.height),u.draw(),b.draw(),l.draw(),y.draw(),p.draw()}const u=new $(c,c);let b=new D(u);function I(){M=!0,h=0,x=300,T.innerHTML=`Score : ${h}`,l=new d(5,10,10,1),y=new d(3,5,5,m()),p=new d(4,8,8,m()),u.grille=Array.from({length:u.hauteur},()=>Array(u.largeur).fill(0)),b=new D(u),j=!1,v=!1,L()}function O(){M=!1,j=!0,clearInterval(L)}function A(){j=!1,v=!1,I()}document.addEventListener("keydown",i=>{if(M)switch(i.key){case"z":l.changeDirection(0);break;case"d":l.changeDirection(1);break;case"s":l.changeDirection(2);break;case"q":l.changeDirection(3);break}});function S(i,e){let t=i.anneaux[0];for(let n of e.anneaux)if(t.i===n.i&&t.j===n.j)return!0;return!1}function R(i,e){const t=document.getElementById("message-overlay");t.textContent=i,t.className=e,t.style.display="flex",setTimeout(()=>{t.style.display="none"},3e3)}function P(){O();let i=5,e=10,t=setInterval(()=>{const n=Math.random()*i-i/2,s=Math.random()*i-i/2;f.style.transform=`translate(${n}px, ${s}px)`,e--,e<=0&&(clearInterval(t),f.style.transform="",R("Perdu !","perdu"))},50)}function F(){O(),R("ðŸŽ‰ Vous avez gagnÃ© ! FÃ©licitations !","gagne")}let k;function L(){clearInterval(k),k=setInterval(()=>{if(j||v){clearInterval(k);return}if(!l.move()){P();return}if(y.move(),p.move(),q(),b.estMangePar(l)){l.extend(),b.placerFruit(),h++,T.innerHTML=`Score : ${h}`;let i=w(u.largeur),e=w(u.hauteur);u.ajouterObstacle(i,e),h%5===0&&(x=Math.max(80,x-40),L()),h===20&&(v=!0,F())}if(l.detecteAutoCollision()||S(l,y)||S(l,p)){P();return}Math.random()<.1&&y.changeDirection(m()),Math.random()<.1&&p.changeDirection(m())},x)}document.getElementById("start").addEventListener("click",I);document.getElementById("restart").addEventListener("click",A);document.addEventListener("keydown",function(i){switch(i.key.toLowerCase()){case"c":I();break;case"r":A();break}});
